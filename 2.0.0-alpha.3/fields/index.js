(()=>{"use strict";var e={275:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;const n=s(374);class a extends n.EventEmitter{constructor(){super(),this._clientData=null,this._origin={sandbox:"https://gadget.payment.qa.91dev.tw",production:"https://gadget.payment.91app.com"}}static getInstance(){return a._instance||(a._instance=new a),a._instance}set clientData(e){this._clientData=Object.assign({},e)}get clientData(){return this._clientData}get version(){return"2.0.0-alpha.3"}get origin(){return this._origin[this.clientData.serverType]}get apiDomain(){return this._origin[this.clientData.serverType]}get iframeDomain(){return this._origin[this.clientData.serverType]}}t.Config=a},374:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0;class s{constructor(e,t,s){this.owner=e,this.event=t,this.callback=s}}t.EventEmitter=class{constructor(){this.listeners=new Map}addListener(e,t){return this.listeners.has(e)||this.listeners.set(e,t),new s(this,e,t)}off(){if(0===arguments.length&&this.listeners.clear(),1===arguments.length&&"object"==typeof arguments[0]){const e=arguments[0];this.off(e.event,e.callback)}else{const[e,t]=Array.from(arguments);this.listeners.has(e)&&this.listeners.delete(e)}}emit(e,t){if(this.listeners.has(e)){const s=this.listeners.get(e);s&&s(t)}}registerEvent(){const e=t=>this.addListener(e,t);return e}}},906:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostMessageEmitter=void 0,t.PostMessageEmitter=class{constructor(e,t){this.target=e,this.origin=t,this.listeners=new Map,window.addEventListener("message",(e=>{const{type:t,payload:s}=e.data;this.listeners.get(t)&&this.listeners.get(t).forEach((t=>{t(e.data)}))}))}on(e,t){this.listeners.get(e)||this.listeners.set(e,[t])}emit(e,t){const s={type:e,payload:t};this.target.postMessage(s,this.origin)}registerEvent(e){return t=>this.on(e,t)}}},887:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.CardBrand=void 0,(s=t.CardBrand||(t.CardBrand={})).Unknown="Unknown",s.MasterCard="MasterCard",s.VISA="VISA",s.JCB="JCB",s.AMEX="AMEX",s.UnionPay="UnionPay"},540:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCardBrand=void 0;const n=s(887);t.getCardBrand=e=>{const t={[n.CardBrand.AMEX]:/^3[47][0-9]{13}$/,[n.CardBrand.VISA]:/^4/,[n.CardBrand.MasterCard]:/^5[1-5]/,[n.CardBrand.JCB]:/^35/,[n.CardBrand.UnionPay]:/^62/};let s=n.CardBrand.Unknown;return Object.keys(t).forEach((n=>{t[n].test(e)&&(s=n)})),s}},615:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseField=void 0;const n=s(906),a=s(887),r=s(316),i=s(275),o=s(917);class d extends n.PostMessageEmitter{constructor(e){super(window.parent,"*"),this.params=e,this.onSyncClientData=this.registerEvent("SYNC_CLIENT_DATA"),this.onSyncCardBrand=this.registerEvent("SYNC_CARD_BRAND"),this.onGetToken=this.registerEvent("GET_TOKEN"),this._status=r.FieldStatus.Normal,this._cardBrand=a.CardBrand.Unknown,this._element=document.getElementById(`field-${e.type}`),e.placeholder&&(this._element.placeholder=e.placeholder),this._element.addEventListener("foucs",this.onFocus.bind(this)),this._element.addEventListener("blur",this.onBlur.bind(this)),this._element.addEventListener("input",this.onChange.bind(this)),this.onSyncClientData((e=>{i.Config.getInstance().clientData=e.payload})),this.onSyncCardBrand((e=>{this.cardBrand=e.payload})),this.onGetToken((e=>{(0,o.getTxnToken)(e.payload).then((e=>{this.emit("ON_GET_TOKEN_COMPLETED",e)}))}))}removeUnlegalCharacter(){/^[0-9\b]+$/.test(this._element.value)||(this._element.value=this._element.value.slice(0,-1))}validate(){this.status===r.FieldStatus.Success&&(this.element.classList.remove("invalid"),this.element.classList.add("valid")),this.status===r.FieldStatus.Error&&(this.element.classList.remove("valid"),this.element.classList.add("invalid"))}onFocus(e){}onBlur(e){}onChange(e){this.removeUnlegalCharacter(),this.validate();const t={type:this.params.type,status:this.status,value:e.target.value};this.emit("ON_UPDATE",t)}get element(){return this._element}set status(e){this._status=e}get status(){return this._status}get cardBrand(){return this._cardBrand}set cardBrand(e){this._cardBrand=e}}t.BaseField=d},38:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CCVField=void 0;const n=s(887),a=s(316),r=s(615);class i extends r.BaseField{constructor(e){super(e),this.params=e}validate(){const e=this.cardBrand===n.CardBrand.AMEX?4:3;this.status=this.element.value.length===e?a.FieldStatus.Success:a.FieldStatus.Error,super.validate()}}t.CCVField=i},256:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExpirationDateField=void 0;const n=s(316),a=s(615);class r extends a.BaseField{constructor(e){super(e),this.params=e}validate(){const e=this.element.value.slice(0,2),t=this.element.value.slice(2,4),s=+(new Date).getFullYear().toString().slice(2,4),a=+(new Date).getFullYear().toString().slice(2,4)+30;this.status=/(^0?[1-9]$)|(^1[0-2]$)/.test(e)&&+t>=s&&+t<a?n.FieldStatus.Success:n.FieldStatus.Error,super.validate()}}t.ExpirationDateField=r},724:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NumberField=void 0;const n=s(887),a=s(540),r=s(316),i=s(615);class o extends i.BaseField{constructor(e){super(e),this.params=e}validate(){const e={[n.CardBrand.Unknown]:/^[0-9]{18}$/,[n.CardBrand.AMEX]:/^3[47][0-9]{13}$/,[n.CardBrand.VISA]:/^4[0-9]{15}$/,[n.CardBrand.MasterCard]:/^5[1-5][0-9]{14}$/,[n.CardBrand.JCB]:/^35[0-9]{14}$/,[n.CardBrand.UnionPay]:/^62[0-9]{14,17}$/};this.status=e[this.cardBrand].test(this.element.value)?r.FieldStatus.Success:r.FieldStatus.Error,super.validate()}onChange(e){this.cardBrand=(0,a.getCardBrand)(e.target.value),this.emit("UPDATE_CARD_BRAND",this.cardBrand),super.onChange(e)}}t.NumberField=o},316:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.FieldStatus=void 0,(s=t.FieldStatus||(t.FieldStatus={}))[s.Normal=0]="Normal",s[s.Success=1]="Success",s[s.Error=-1]="Error"},917:function(e,t,s){var n=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(a,r){function i(e){try{d(n.next(e))}catch(e){r(e)}}function o(e){try{d(n.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.getTxnToken=void 0;const a=s(275);t.getTxnToken=e=>n(void 0,void 0,void 0,(function*(){try{const t=`${a.Config.getInstance().apiDomain}/api/Payment/GetTxnToken`,s=yield fetch(t,{body:JSON.stringify(e),method:"POST",headers:{"content-type":"application/json"}});return Promise.resolve(s.json())}catch(e){return Promise.reject(e)}}))}},t={};function s(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,s),r.exports}(()=>{const e=s(724),t=s(256),n=s(38);document.addEventListener("DOMContentLoaded",(()=>{if(!window.location.search.length)return;const s=JSON.parse(decodeURIComponent(window.location.search.replace("?","")));let a;[].forEach.call(document.querySelectorAll("form"),(e=>{e.id!==`${s.type}-form`&&e.remove()})),"number"===s.type&&(a=new e.NumberField(s)),"expirationDate"===s.type&&(a=new t.ExpirationDateField(s)),"ccv"===s.type&&(a=new n.CCVField(s))}))})()})();
//# sourceMappingURL=index.js.map?t=e94f372616fbd47dc9c6