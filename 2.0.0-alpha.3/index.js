(()=>{"use strict";var e={275:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;const i=s(374);class n extends i.EventEmitter{constructor(){super(),this._clientData=null,this._origin={sandbox:"https://gadget.payment.qa.91dev.tw",production:"https://gadget.payment.91app.com"}}static getInstance(){return n._instance||(n._instance=new n),n._instance}set clientData(e){this._clientData=Object.assign({},e)}get clientData(){return this._clientData}get version(){return"2.0.0-alpha.3"}get origin(){return this._origin[this.clientData.serverType]}get apiDomain(){return this._origin[this.clientData.serverType]}get iframeDomain(){return this._origin[this.clientData.serverType]}}t.Config=n},374:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0;class s{constructor(e,t,s){this.owner=e,this.event=t,this.callback=s}}t.EventEmitter=class{constructor(){this.listeners=new Map}addListener(e,t){return this.listeners.has(e)||this.listeners.set(e,t),new s(this,e,t)}off(){if(0===arguments.length&&this.listeners.clear(),1===arguments.length&&"object"==typeof arguments[0]){const e=arguments[0];this.off(e.event,e.callback)}else{const[e,t]=Array.from(arguments);this.listeners.has(e)&&this.listeners.delete(e)}}emit(e,t){if(this.listeners.has(e)){const s=this.listeners.get(e);s&&s(t)}}registerEvent(){const e=t=>this.addListener(e,t);return e}}},906:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostMessageEmitter=void 0,t.PostMessageEmitter=class{constructor(e,t){this.target=e,this.origin=t,this.listeners=new Map,window.addEventListener("message",(e=>{const{type:t,payload:s}=e.data;this.listeners.get(t)&&this.listeners.get(t).forEach((t=>{t(e.data)}))}))}on(e,t){this.listeners.get(e)||this.listeners.set(e,[t])}emit(e,t){const s={type:e,payload:t};this.target.postMessage(s,this.origin)}registerEvent(e){return t=>this.on(e,t)}}},887:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.CardBrand=void 0,(s=t.CardBrand||(t.CardBrand={})).Unknown="Unknown",s.MasterCard="MasterCard",s.VISA="VISA",s.JCB="JCB",s.AMEX="AMEX",s.UnionPay="UnionPay"},252:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CreditCard=void 0;const i=s(374),n=s(432),a=s(316),r=s(887),o=s(275);class d extends i.EventEmitter{constructor(){super(),this.onUpdate=this.registerEvent(),this.setup=this.setup.bind(this),this.getTxnToken=this.getTxnToken.bind(this),this.fields={number:null,expirationDate:null,ccv:null},this.creditCardData={canGetToken:!1,cardBrand:r.CardBrand.Unknown,fields:{number:{status:a.FieldStatus.Normal,value:""},expirationDate:{status:a.FieldStatus.Normal,value:""},ccv:{status:a.FieldStatus.Normal,value:""}}}}setup(e){if(!o.Config.getInstance().clientData)throw new Error("Error: Please run PaymentSDK.setupSDK(appId, appKey, serverType)");this.setupConfig=e,this.createFields()}createFields(){Object.keys(this.setupConfig.fields).forEach((e=>{const t=e,s="string"==typeof this.setupConfig.fields[t].element?document.getElementById(this.setupConfig.fields[t].element.toString().replace("#","")):this.setupConfig.fields[t].element,i={type:t,placeholder:this.setupConfig.fields[t].placeholder},a=document.createElement("iframe");a.src=`${o.Config.getInstance().iframeDomain}/fields/index.html?${encodeURIComponent(JSON.stringify(i))}`,s.appendChild(a);const r=new n.FieldFrame(a);this.fields[t]=r,r.onUpdateCardBrand((e=>{this.creditCardData.cardBrand=e.payload,r.emit("SYNC_CARD_BRAND",e.payload),this.emit(this.onUpdate,this.creditCardData)})),r.onUpdate((e=>{const t=Object.assign(Object.assign({},this.creditCardData.fields),{[e.payload.type]:{status:e.payload.status,value:e.payload.value}});this.creditCardData=Object.assign(Object.assign({},this.creditCardData),{fields:Object.assign({},t),canGetToken:void 0===Object.keys(t).find((e=>1!==t[e].status))}),this.emit(this.onUpdate,this.creditCardData)}))}))}getTxnToken(e){const t={appId:o.Config.getInstance().clientData.appId.toString(),appKey:o.Config.getInstance().clientData.appKey,sdkVer:o.Config.getInstance().version,cardNumber:this.creditCardData.fields.number.value,cardExpiryDate:this.creditCardData.fields.expirationDate.value,cardSecurityCode:this.creditCardData.fields.ccv.value};this.fields.number.emit("GET_TOKEN",t),this.fields.number.onGetTokenCompleted((t=>{e(t.payload)}))}}t.CreditCard=d},316:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.FieldStatus=void 0,(s=t.FieldStatus||(t.FieldStatus={}))[s.Normal=0]="Normal",s[s.Success=1]="Success",s[s.Error=-1]="Error"},432:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FieldFrame=void 0;const i=s(906),n=s(275);class a extends i.PostMessageEmitter{constructor(e){super(e.contentWindow,"*"),this.element=e,this.onUpdate=this.registerEvent("ON_UPDATE"),this.onUpdateCardBrand=this.registerEvent("UPDATE_CARD_BRAND"),this.onGetTokenCompleted=this.registerEvent("ON_GET_TOKEN_COMPLETED"),this.element.setAttribute("scrolling","no"),this.element.setAttribute("frameborder","0"),this.element.setAttribute("allowtransparency","true"),this.element.setAttribute("width","100%"),this.element.setAttribute("height","100%"),this.element.addEventListener("load",(()=>{this.emit("SYNC_CLIENT_DATA",n.Config.getInstance().clientData)}))}}t.FieldFrame=a}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,s),a.exports}(()=>{const e=s(275),t=s(252);window.PaymentSDK=new class{constructor(){this.setupSDK=(t,s,i)=>{e.Config.getInstance().clientData={appId:t,appKey:s,serverType:i},this.createPayment()},this.setupSDK=this.setupSDK.bind(this)}createPayment(){this.creditCard=new t.CreditCard}}})()})();
//# sourceMappingURL=index.js.map?t=60e29b8d732d6712a2a6