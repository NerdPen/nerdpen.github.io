(()=>{"use strict";var e={275:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;const i=s(374);class a extends i.EventEmitter{constructor(){super(),this._clientData=null,this._origin={sandbox:"https://gadget.payment.qa.91dev.tw",production:"https://gadget.payment.91app.com"}}static getInstance(){return a._instance||(a._instance=new a),a._instance}set clientData(e){this._clientData=Object.assign({},e)}get clientData(){return this._clientData}get version(){return"2.0.0-alpha.3"}get origin(){return this._origin[this.clientData.serverType]}get apiDomain(){return this._origin[this.clientData.serverType]}get iframeDomain(){return this._origin[this.clientData.serverType]}}t.Config=a},374:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this.listeners=new Map}on(e,t){this.listeners.has(e)?this.listeners.get(e).push(t):this.listeners.set(e,[t])}emit(e,t){this.listeners.has(e)&&this.listeners.get(e).forEach((e=>{e(t)}))}off(e){this.listeners.has(e)&&this.listeners.delete(e)}}},906:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostMessageEmitter=void 0,t.PostMessageEmitter=class{constructor(e,t,s){this.current=e,this.target=t,this.origin=s,this.listeners=new Map,this.current.addEventListener("message",(e=>{const{type:t,payload:s}=e.data;this.listeners.get(t)&&this.listeners.get(t).forEach((e=>{e(s)}))}))}on(e,t){this.listeners.get(e)||this.listeners.set(e,[t])}emit(e,t){const s={type:e,payload:t};this.target.postMessage(s,this.origin)}registerEvent(e){return t=>this.on(e,t)}}},887:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.CardBrand=void 0,(s=t.CardBrand||(t.CardBrand={})).Unknown="Unknown",s.MasterCard="MasterCard",s.VISA="VISA",s.JCB="JCB",s.AMEX="AMEX",s.UnionPay="UnionPay"},252:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CreditCard=void 0;const i=s(374),a=s(432),r=s(316),n=s(887),d=s(275);class o extends i.EventEmitter{constructor(){super(),this.setup=this.setup.bind(this),this.getToken=this.getToken.bind(this),this.creditCardData={canGetToken:!1,cardBrand:n.CardBrand.Unknown,fields:{number:{target:null,status:r.FieldStatus.Normal,value:"",errorMessage:""},expirationDate:{target:null,status:r.FieldStatus.Normal,value:"",errorMessage:""},ccv:{target:null,status:r.FieldStatus.Normal,value:"",errorMessage:""}}}}setup(e){if(!d.Config.getInstance().clientData)throw new Error("Error: Please run PaymentSDK.setupSDK(appId, appKey, serverType)");this.setupConfig=e,this.createFields()}createFields(){Object.keys(this.setupConfig.fields).forEach((e=>{const t=e,s="string"==typeof this.setupConfig.fields[t].element?document.getElementById(this.setupConfig.fields[t].element.toString().replace("#","")):this.setupConfig.fields[t].element,i=document.createElement("iframe"),r={type:t,placeholder:this.setupConfig.fields[t].placeholder};i.src=`${d.Config.getInstance().iframeDomain}/fields/index.html?${encodeURIComponent(JSON.stringify(r))}`,s.appendChild(i);const n=new a.FieldFrame(i);this.creditCardData.fields[t].target=n,n.onUpdateCardBrand((e=>{this.creditCardData.cardBrand=e,"number"!==t&&n.emit("SYNC_CARD_BRAND",e)})),n.onUpdate((e=>{this.creditCardData=Object.assign(Object.assign({},this.creditCardData),{fields:Object.assign(Object.assign({},this.creditCardData.fields),{[e.type]:Object.assign(Object.assign({},this.creditCardData.fields[e.type]),{status:e.status,value:e.value,errorMessage:e.errorMessage})})}),this.creditCardData.canGetToken=void 0===Object.keys(this.creditCardData.fields).find((e=>1!==this.creditCardData.fields[e].status));const s=Object.assign(Object.assign({},this.creditCardData),{fields:{number:{status:this.creditCardData.fields.number.status,errorMessage:this.creditCardData.fields.number.errorMessage},expirationDate:{status:this.creditCardData.fields.expirationDate.status,errorMessage:this.creditCardData.fields.expirationDate.errorMessage},ccv:{status:this.creditCardData.fields.ccv.status,errorMessage:this.creditCardData.fields.ccv.errorMessage}}});"number"===t&&this.emit("UPDATE",s)}))}))}getFieldData(e){return this.creditCardData.fields[e]}getToken(e){const t={appId:d.Config.getInstance().clientData.appId.toString(),appKey:d.Config.getInstance().clientData.appKey,sdkVer:d.Config.getInstance().version,cardNumber:this.getFieldData("number").value,cardExpiryDate:this.getFieldData("expirationDate").value,cardSecurityCode:this.getFieldData("ccv").value};this.getFieldData("number").target.onGetTokenCompleted((t=>{e(t)})),this.getFieldData("number").target.emit("GET_TOKEN",t)}onUpdate(e){return this.on("UPDATE",(t=>{e(t)}))}}t.CreditCard=o},316:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.FieldStatus=void 0,(s=t.FieldStatus||(t.FieldStatus={}))[s.Normal=0]="Normal",s[s.Success=1]="Success",s[s.Error=-1]="Error"},432:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FieldFrame=void 0;const i=s(906),a=s(275);class r extends i.PostMessageEmitter{constructor(e){super(window,e.contentWindow,"*"),this.element=e,this.onUpdate=this.onUpdate.bind(this),this.onUpdateCardBrand=this.onUpdateCardBrand.bind(this),this.onGetTokenCompleted=this.onGetTokenCompleted.bind(this),this.element.setAttribute("scrolling","no"),this.element.setAttribute("frameborder","0"),this.element.setAttribute("allowtransparency","true"),this.element.setAttribute("width","100%"),this.element.setAttribute("height","100%"),this.element.addEventListener("load",(()=>this.syncClientData()))}syncClientData(){this.emit("SYNC_CLIENT",a.Config.getInstance().clientData)}onUpdate(e){return this.on("UPDATE_FIELD",(t=>{e(t)}))}onUpdateCardBrand(e){return this.on("UPDATE_CARD_BRAND",(t=>{e(t)}))}onGetTokenCompleted(e){return this.on("GET_TOKEN_COMPLETED",(t=>{e(t)}))}}t.FieldFrame=r}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}(()=>{const e=s(275),t=s(252);window.PaymentSDK=new class{constructor(){this.setupSDK=(e,t,s)=>{this.config.clientData={appId:e,appKey:t,serverType:s},this.createPayment()},this.config=e.Config.getInstance(),this.setupSDK=this.setupSDK.bind(this)}createPayment(){this.creditCard=new t.CreditCard}}})()})();
//# sourceMappingURL=index.js.map?t=f8a1078c74be8e707d8a